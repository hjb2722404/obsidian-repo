# 位运算基础知识全面总结


## 位运算符都有哪些

|位运算符| 名称| 描述 |
|--|--| --|
|&|AND 按位与|如果两位都是1，则设置该位为1|
|\||OR 按位或|如果两位之一为1，则设该位为1|
|^|XOR按位异或|如果两位只有一位为1，则设置每位为1|
|~|NOT 按位非| 反转所有位|
|<<|领填充左位移|通过从右推入零向左位移，并使最左边的位脱落|
|>>|有符号右位移|通过从左推入最左位的拷贝来向右位移，并使最右边的位脱落|
|>>>|零填充右位移|通过从左推入零来向右位移，并使最右边的位脱落|

## 位运算本质解析

### 0 二进制的一些规律

在进行位运算解析前，我们先来看看二进制数的一些规律。

我们可以列出15以内的数的二进制数（因为四个二进制位可以表达的无符号数范围为 0 ~ (2<sup>4</sup> -1) ,即 0 ~ 15），进一步探寻其中的本质：

| 十进制数 | 二   | 进   | 制   | 数   |
| -------- | ---- | ---- | ---- | ---- |
| 0        | 0    | 0    | 0    | 0    |
| 1        | 0    | 0    | 0    | 1    |
| 2        | 0    | 0    | 1    | 0    |
| 3        | 0    | 0    | 1    | 1    |
| 4        | 0    | 1    | 0    | 0    |
| 5        | 0    | 1    | 0    | 1    |
| 6        | 0    | 1    | 1    | 0    |
| 7        | 0    | 1    | 1    | 1    |
| 8        | 1    | 0    | 0    | 0    |
| 9        | 1    | 0    | 0    | 1    |
| 10       | 1    | 0    | 1    | 0    |
| 11       | 1    | 0    | 1    | 1    |
| 12       | 1    | 1    | 0    | 0    |
| 13       | 1    | 1    | 0    | 1    |
| 14       | 1    | 1    | 1    | 0    |
| 15       | 1    | 1    | 1    | 1    |

> 规律1： 奇数第1位是1，偶数第1位是0.

其次:

* 【数】这一列，从0~15是[01] 循环
* 【制】这一列，从0~15是[0011] 循环
* 【进】这一列，从0~15是[00001111]循环
* 【二】这一列，从0~15 是 [ 00000000 11111111] 循环

可以总结出第二个规律：

> 规律2： 在二进制里，随着数字变大，其第n列上的数字总是 [0 *2<sup>n</sup> 与 1 * 2<sup>n</sup> ] 这一组合循环出现

借助这个规律，我们可以迅速写出一个数的二进制数，比如 28 这个数：

* 首先，我们确定离它最近的比它大的2的幂是2<sup>6</sup> （32），可以知道它的二进制总共有5位有效数字，因为还未达到2<sup>6</sup>

* 然后分别计算5位有效数字

  * 第5列的循环式是[16个0+16个1]循环，28是第29个【因为0是第1个】，所以第5位是 1；
  * 第4列的循环式是[8个0+8个1]循环，28是第29个，处于第二次循环的第13个（1*16 + 13），所以第4位是1
  * 第3列的循环式是[4个0+4个1]循环， 28是第29个，处于第四次循环的第5个（3*8=24,24+5=29），所以第3位是1；
  * 第2列的循环式是[2个0+2个1]循环，28是第29个，处于第8次循环的第1个(4*7=28，28+1=29)，所以第2位是0；
  * 由于28是偶数，所以第1位是0；

  得到： ` 11100 `

继续，我们还可以发现：

* 1 = 2<sup>0</sup> = 0001
* 2 = 2<sup>1</sup> = 0010
* 4 = 2<sup>2</sup> = 0100
* 8 = 2<sup>3</sup> = 1000

> 规律3：如果一个数是2的n次幂的值，那么它的第 n+ 1位为1，其余位为0

继续：

* 1 = 2 - 1 = 2<sup>1</sup> - 1 = 0001;
* 3 = 4 - 1 = 2<sup>2</sup> -1 = 0011;
* 7 = 8-1 =  2<sup>3</sup> - 1 = 0111;
* 15 = 16 -1 = 2<sup>4</sup> -1 = 1111;

> 规律4： 2<sup>n</sup> -1 的 1 ~ n 位为1，其余位为0

知道了以上规律，我们再来看位算符。

###  1.按位与 —— &

按位与的操作逻辑是 两个二进制数，相同位置的数如果都是1，则计算结果的对应位置上1，其它情况下计算结果对应位置上为0：

例如： `13 & 6`

| 十进制数                            | 二   | 进   | 制   | 数   |
| ----------------------------------- | ---- | ---- | ---- | ---- |
| 13                                  | 1    | 1    | 0    | 1    |
| 6                                   | 0    | 1    | 1    | 0    |
| 计算结果(右边是二进制,下面是十进制) | 0    | 1    | 0    | 0    |
| 4                                   |      |      |      |      |

然后我们根据这个特点总结一些规律：

####  `n & 1` 要么等于1，要么等于0

因为

* 1的二进制是`00000000000000000000000000000001`, 
* 任意数`n`的最后一位要么是`0`, 要么是`1`, 而其它所有的位与1的前31位`0`做与运算结果都是`0`,最后一位决定了表达式最后的结果。
  * 最后一位为`0`的一定是偶数，最后一位为`1`的一定是奇数，因为
    * 最后一位是 0 乘以 2的0次方 或 1乘以 2的0次方，
      * 2的0次方是1。 
      * 而0乘以1 = 0， 1乘以1等于1。
  * 前面31位的结果是0或1乘以2的1-31次方，结果都是偶数，偶数相加还是偶数，
  * 所以最后一位加0还是加1决定了它是否是奇数。

此方法可以用来判断数的奇偶性，结果为1就是奇数，结果为0就是偶数。

#### `n &= (n-1)` 可以清除`n`的二进制的最右边的1，

因为从二进制讲，n 相当于在 n-1 的最低位加上1。这种情形下，n的最后一位第 x 位 的1一定是：

* 情形1：（n-1的）第x位原来是0，（n-1的）(x-1)位的1加了1之后进位而变为1

* 情形2：（n-1的）第x位原来是0，（n-1）的第x位加1之后变为了1

  所以当n跟n-1做按位与与运算时，无论是哪种情形，它的第x位的1与n-1的第x位做与运算是都会变为0。

* 当n为奇数时，清除最右边的1，相当于减1，此时 n & (n -1) 等于 n -1;
* 当n 为偶数时：
  * 如果n = 2<sup>x</sup> ，则 结果为0；比如： 2&1=0； 4&3=0； 8&7=0；等等
  * 否则
    * 如果 n = 2<sup>x</sup> + 2<sup>x+1</sup>， 则 n & n-1 = 2<sup>x</sup>， 例如
      *  2<sup>1</sup> + 2<sup>2</sup> = 6  & 5 = 2  = 2<sup>1</sup>
      * 2<sup>2</sup> + 2<sup>3</sup> = 12 & 11 = 8 = 2 <sup>2</sup>
      * 2<sup>3</sup> + 2<sup>4</sup>  = 24 & 23 = 16 = 2<sup>3</sup>
    * 其它情况下， n & n-1 = 2;




## 位运算符的特点

所有的位运算都是32位运算的，但我们知道，大多数程序语言都是使用64位浮点数的。

尤其是小数，都是64位存储的，这意味着，我们可以使用位运算的这种特性截去小数的二进制的后32位，从而达到取整的效果：

比如对于小数`1.23456789`，将其转换为二进制为：

```js
let a = 1.23456789;
a.toString(2)
//'1.0011110000001100101001000010100000111101111000011011'
```

我们让它与0进行位运算




* `>>>` 右移1位等于除以2

* 对于任意一个正整数`n`，

  * 如果它是偶数，那么它的二进制中1的个数与`n/2`中的1的个数是相同的，因为n是由n/2左移一位而来，移位并不会增加1的个数。
  * 如果他是奇数，那么它的二进制中的个数是n/2中1的个数加1， 因为当n是奇数时，n相当于n/2左移一位再加1.

* 按位异或三定律及其延伸应用：

  * `a ^ b ^ c <=> a ^ c ^ b`

  * `n ^ 0 => n`;
  * `n ^ n => 0`;
  * 可得： a ^ a ^ b => 0

## 应用分析

### 1. js生成随机颜色

