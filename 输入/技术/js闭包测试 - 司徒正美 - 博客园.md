js闭包测试 - 司徒正美 - 博客园

# [Ruby's Louvre](https://www.cnblogs.com/rubylouvre/)

每天学习一点点算法

### 导航

- [博客园](https://www.cnblogs.com/)
- [首页](https://www.cnblogs.com/rubylouvre/)
- [新随笔](https://i.cnblogs.com/EditPosts.aspx?opt=1)
- [联系](https://msg.cnblogs.com/send/%E5%8F%B8%E5%BE%92%E6%AD%A3%E7%BE%8E)
- [订阅](js闭包测试%20-%20司徒正美%20-%20博客园.md#)[![xml.gif](../_resources/f80f983ecf349c7b03c6127114f9d354.gif)](https://www.cnblogs.com/rubylouvre/rss/)
- [管理](https://i.cnblogs.com/)

|     |     |     |
| --- | --- | --- |
|  [<](js闭包测试%20-%20司徒正美%20-%20博客园.md#) | 2020年10月 |  [>](js闭包测试%20-%20司徒正美%20-%20博客园.md#) |

日
一
二
三
四
五
六
27
28
29
30
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
1
2
3
4
5
6
7

### 统计

- 随笔 - 1256
- 文章 - 160
- 评论 - 6043
- 引用 - 0

### 公告

[![](https://s03./count/dM5/bg=DDDDCC/txt=000000/border=DDDDCC/columns=2/maxflags=20/viewers=0/labels=0/pageviews=1/)](http://s03./more/dM5)

[![o_book3.jpg](../_resources/60a098cab267b6b471098a59f5b65ea1.jpg)](http://item.jd.com/11436424.html)

[偶写的书](http://item.jd.com/11436424.html)[点我下载](https://files.cnblogs.com/rubylouvre/JavaScript%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1%E6%96%B0.rar)

 [我的微博](http://weibo.com/jslouvre)  JS交流群：242720215，31905538，228372837,208841633,79641290   10881959[入群者先看这里](http://www.cnblogs.com/rubylouvre/archive/2010/03/12/1684774.html)。

昵称： [司徒正美](https://home.cnblogs.com/u/rubylouvre/)
园龄： [11年5个月](https://home.cnblogs.com/u/rubylouvre/)
荣誉： [推荐博客](https://www.cnblogs.com/expert/)
粉丝： [8901](https://home.cnblogs.com/u/rubylouvre/followers/)
关注： [77](https://home.cnblogs.com/u/rubylouvre/followees/)
[+加关注](js闭包测试%20-%20司徒正美%20-%20博客园.md#)

### 搜索

### 常用链接

- [我的随笔](https://www.cnblogs.com/rubylouvre/p/)
- [我的评论](https://www.cnblogs.com/rubylouvre/MyComments.html)
- [我的参与](https://www.cnblogs.com/rubylouvre/OtherPosts.html)
- [最新评论](https://www.cnblogs.com/rubylouvre/RecentComments.html)
- [我的标签](https://www.cnblogs.com/rubylouvre/tag/)

### 我的标签

- [javascript(615)](https://www.cnblogs.com/rubylouvre/tag/javascript/)

- [avalon(133)](https://www.cnblogs.com/rubylouvre/tag/avalon/)

- [mass(111)](https://www.cnblogs.com/rubylouvre/tag/mass/)

- [css(88)](https://www.cnblogs.com/rubylouvre/tag/css/)

- [html(50)](https://www.cnblogs.com/rubylouvre/tag/html/)

- [ruby(32)](https://www.cnblogs.com/rubylouvre/tag/ruby/)

- [思考(24)](https://www.cnblogs.com/rubylouvre/tag/%E6%80%9D%E8%80%83/)

- [node.js(22)](https://www.cnblogs.com/rubylouvre/tag/node.js/)

- [python(21)](https://www.cnblogs.com/rubylouvre/tag/python/)

- [selector(16)](https://www.cnblogs.com/rubylouvre/tag/selector/)

- [更多](https://www.cnblogs.com/rubylouvre/tag/)

### 积分与排名

- 积分 - 2069751

- 排名 - 38

### css3

- [sketchpad](http://mugtug.com/sketchpad/)
- [css手册](http://css.doyoe.com/)
- [css-tricks](http://css-tricks.com/)

### javascript

- [ajaxian](http://www.ajaxian.com/)
- [nanto](http://nanto.asablo.jp/blog/2009/08/)
- [diveintohtml5](http://diveintohtml5.org/everything.html)
- [developer.mozilla.org](https://developer.mozilla.org/en/CSS_Reference)
- [ecmascript](http://www.ecmascript.org/)
- [ppk](http://www.quirksmode.org/)
- [es5](http://es5conform.codeplex.com/)
- [Eric Meyer](http://meyerweb.com/)
- [高性能网站建设](http://www.stevesouders.com/blog/)
- [webfx](http://webfx.eae.net/)
- [sitepoint](http://www.sitepoint.com/)
- [alistapart](http://www.alistapart.com/articles/)
- [closure-compiler](http://closure-compiler.appspot.com/home)
- [perfectionkills](http://perfectionkills.com/)
- [webkit系的文档](http://www.webkit.org/)
- [结构之法 算法之道](http://blog.csdn.net/v_july_v/article/details/6879101)
- [http://koajs.cn/
- [es6](http://es6.ruanyifeng.com/)
- [IE6、IE7、IE8浏览器](http://dl.dbank.com/c0ixfbqjep#)

### 工具

- [Packer-Decoder](http://www.yaohaixiao.com/effects/Packer-Decoder.html)
- [jsbeautifier](http://jsbeautifier.org/)
- [User Agent](http://www.useragentstring.com/)
- [jslint](http://www.jslint.com/)
- [cleancss](http://www.cleancss.com/index.php)
- [closure-compiler](http://closure-compiler.appspot.com/home)
- [css-validator](http://jigsaw.w3.org/css-validator/)
- [stackoverflow](http://stackoverflow.com/questions/2349378/new-programming-jargon-you-coined)
- [在线格式化HTML](http://infohound.net/tidy/)
- [http://proxyie.cn/
- [http://css-infos.net/](http://css-infos.net/property/-webkit-animation-direction)
- [http://docs.webplatform.org/wiki/dom/methods

### 好友链接

- [Biny](http://www.cnblogs.com/binyong/)
- [带刀](http://stylechen.com/)
- [cloudgamer](http://www.cnblogs.com/cloudgamer/)
- [小haha](http://www.beiju123.cn/blog/)
- [corodidea.infinte](http://typeof.net/)
- [abcdreamer](http://www.piscean.net/labs/)
- [LC](http://www.cnblogs.com/bluedream2009/)
- [晴天小猪](http://www.cnblogs.com/meimeiwa/)

### 最新评论

- [1. Re:自定义元素 – 在 HTML 中定义新元素](https://www.cnblogs.com/rubylouvre/p/3307413.html)

- Document.registerElement()已废弃

customElements.define() 新api

- --hackftz

- [2. Re:leetcode 91. Decode Ways](https://www.cnblogs.com/rubylouvre/p/12210814.html)

-

- --xgqfrms

- [3. Re:leetcode 91. Decode Ways](https://www.cnblogs.com/rubylouvre/p/12210814.html)

- 愿逝者安息

- --cshenger

- [4. Re:迷你MVVM框架 avalonjs1.5 入门教程](https://www.cnblogs.com/rubylouvre/p/4783966.html)

- 前辈，走好！

- --darklx

- [5. Re:最新手机号码验证正则表达式js版](https://www.cnblogs.com/rubylouvre/archive/2012/09/30/2709302.html)

- 这样写 其实 不太好 太死板了 use this

/^1[3456789]\d{9}$/

- --hackftz

### 阅读排行榜

- [1. 迷你MVVM框架 avalonjs 入门教程(221802)](https://www.cnblogs.com/rubylouvre/p/3181291.html)

- [2. javascript正则表达式(123368)](https://www.cnblogs.com/rubylouvre/archive/2010/03/09/1681222.html)

- [3. 我的《javascript框架设计》终于出版(72061)](https://www.cnblogs.com/rubylouvre/p/3658441.html)

- [4. python学习笔记——字典(65874)](https://www.cnblogs.com/rubylouvre/archive/2011/06/19/2084739.html)

- [5. node.js入门(57906)](https://www.cnblogs.com/rubylouvre/archive/2010/07/15/1778403.html)

- [6. css 文本两端对齐(56618)](https://www.cnblogs.com/rubylouvre/archive/2012/11/28/2792504.html)

- [7. javascript操作referer(51406)](https://www.cnblogs.com/rubylouvre/p/3541411.html)

- [8. javascript contains方法(51235)](https://www.cnblogs.com/rubylouvre/archive/2009/10/14/1583523.html)

- [9. FormData对象(47857)](https://www.cnblogs.com/rubylouvre/archive/2011/04/26/2028827.html)

- [10. 迷你MVVM框架 avalonjs1.5 入门教程(44737)](https://www.cnblogs.com/rubylouvre/p/4783966.html)

- [11. (转)CSS3 @font-face(44386)](https://www.cnblogs.com/rubylouvre/archive/2011/06/19/2084875.html)

- [12. node.js 文件操作(42920)](https://www.cnblogs.com/rubylouvre/archive/2011/11/28/2264717.html)

- [13. document.getElementsByClassName的理想实现(42155)](https://www.cnblogs.com/rubylouvre/archive/2009/07/24/1529640.html)

- [14. JavaScript trim函数大赏(41896)](https://www.cnblogs.com/rubylouvre/archive/2009/09/18/1568794.html)

- [15. node.js操作Cookie(35776)](https://www.cnblogs.com/rubylouvre/archive/2012/08/19/2645644.html)

### 评论排行榜

- [1. 我的《javascript框架设计》终于出版(225)](https://www.cnblogs.com/rubylouvre/p/3658441.html)

- [2. 迷你MVVM框架 avalonjs 入门教程(118)](https://www.cnblogs.com/rubylouvre/p/3181291.html)

- [3. 迷你MVVM框架 avalonjs1.5 入门教程(102)](https://www.cnblogs.com/rubylouvre/p/4783966.html)

- [4. 有关加QQ群的问题(97)](https://www.cnblogs.com/rubylouvre/archive/2010/03/12/1684774.html)

- [5. 原来jQuery的性能是如此差的(91)](https://www.cnblogs.com/rubylouvre/archive/2010/02/26/1673098.html)

## [js闭包测试](https://www.cnblogs.com/rubylouvre/p/3345294.html)

本文的诞生，源自近期打算做的一个关于javascript中的闭包的专题，由于需要解析闭包对垃圾回收的影响，特此针对不同的javascript引擎，做了相关的测试。

为了能从本文中得到需要的知识，看本文前，请明确自己知道闭包的概念，并对垃圾回收的常用算法有一定的了解。
问题的提出
假设有如下的代码：
[object Object]  [object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object]
[object Object][object Object]  [object Object][object Object]
[object Object][object Object][object Object][object Object]
[object Object][object Object]
[object Object]
[object Object]  [object Object]

|  |
|  |

在这一段代码中，outer函数和inner函数间会形成一个闭包，致使inner函数能够访问到largeObject，但是显然inner并没有访问largeObject，那么在闭包中的largeObject对象是否能被回收呢？

如果引入更复杂的情况：
[object Object]  [object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object]
[object Object][object Object]  [object Object][object Object]
[object Object][object Object]
[object Object][object Object][object Object][object Object]
[object Object][object Object]
[object Object]
[object Object]  [object Object]

|  |
|  |

首先一个显然的概念是largeObject肯定不能被回收，因为inner确实地需要使用它。但是anotherLargeObject又能不能被回收呢？它将跟随largeObject一起始终存在，还是和largeObject分离，独立地被回收呢？

**测试方法**
带着这个疑问，对现有的几款现代javascript引擎分别进行了测试，参与测试的有：
~IE8自带的JScript.dll
~IE9自带的Chakra
~Opera 11.60自带的Carakan
~Chrome 16.0.912.63自带的V8（3.6.6.11）
~Firefox 9.0.1自带的SpiderMonkey
测试的基本方案是，使用类似以下的代码：
[object Object]  [object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object]
[object Object][object Object]  [object Object][object Object]
[object Object][object Object]
[object Object][object Object]
[object Object]
[object Object]  [object Object]

|  |
|  |

通过各浏览器的开发者工具（Developer Tools、Firebug、Dragonfly等），在断点处停止javascript的执行，并通过控制台或本地变量查看功能检查largeObject的值，如果其值存在，则认为GC并没有回收该对象。

对于部分浏览器（特别是IE），考虑到对脚本执行有2种模式（执行模式和调试模式，IE通过开发者工具的Script面板中的“Start Debugging”按钮切换），在调试模式下才会命中断点，但是调试模式下可能存在不同的引擎优化方案，因此采用内存比对的方式进行测试。即打开资源浏览器，在var inner = outer();一行后强制执行一次垃圾回收（IE使用window.CollectGarbage()；Opera使用window.opera.collect();），查看内存的变化。如果内存始终有100MB的占用，没有明显的下降现象，则认为GC并没有回收该对象。

对于用例的设计，由于从ECMAScript标准中可以得知，所有的变量访问是通过一个LexicalEnvironment对象进行的，因此目标在于在不同的LexicalEnvironment结构下进行测试。从标准中，搜索LexicalEnvironment不难得出能够改变LexicalEnvironment结构的情况有以下几种：

1.进入一个函数。
2.进入一段eval代码。
3.使用with语句。
4.使用catch语句。
因此以下将针对这4种情况，进行多用例的测试。
**测试过程级结果**
**基本测试**
**使用代码**
[object Object]  [object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object]
[object Object][object Object]  [object Object][object Object]
[object Object][object Object]
[object Object][object Object]
[object Object]
[object Object]  [object Object]

|  |
|  |

**测试结果**
~JScript.dll – 不回收，内存无下降趋势。
~Chakra – 回收，内存会恢复到outer函数执行前的状态。
~Carakan – 不回收，内存无下降趋势。
~V8 – 回收，访问largeObject抛出ReferenceError。
~SpiderMonkey – 回收，访问largeObject得到undefined。
**结论**

当一个函数outer返回另一个函数inner时，Chakra、V8和SpiderMonkey会对outer中声明，但inner中不使用的变量进行回收，其中V8直接将变量从LexicalEnvironment上解除绑定，而SpiderMonkey仅仅将变量的值设为undefined，并不解除绑定。

**多个变量的情况**
**使用代码**
[object Object]  [object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object]
[object Object][object Object]  [object Object][object Object]
[object Object][object Object]
[object Object][object Object]
[object Object][object Object]
[object Object]
[object Object]  [object Object]
[object Object]

|  |
|  |

**测试结果**
~JScript.dll – 不回收，内存无下降趋势。
~Chakra – 回收anotherLargeObject，内存会回到outer调用前并增加100MB左右。
~Carakan – 不回收，内存无下降趋势。
~V8 – 回收，访问largeObject能得到正确的值，访问anotherLargeObject抛出ReferenceError。
~SpiderMonkey – 回收，访问largeObject能得到正确的值，访问anotherLargeObject得到undefined。
**结论**

当一个LexicalEnvironment上存在多个变量绑定时，Chakra、V8和SpiderMonkey会针对不同的变量判断是否有被使用，该判断方法是扫描返回的函数inner的源码来实现的，随后会将没有被inner使用的变量从LexicalEnvironment中解除绑定（同样的，SpiderMonkey不解除绑定，仅赋值为undefined），而剩下的变量继续保留。

**eval的影响**
**使用代码**
[object Object]  [object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object]
[object Object][object Object]  [object Object][object Object]
[object Object][object Object][object Object][object Object]
[object Object][object Object]
[object Object][object Object]
[object Object]
[object Object]  [object Object]
[object Object]

|  |
|  |

**测试结果**
~JScript.dll – 不回收，内存无下降趋势。
~Chakra – 不回收，内存无下降趋势。
~Carakan – 不回收，内存无下降趋势。
~V8 – 不回收，访问largeObject可得到正确的值。
~SpiderMonkey – 不回收，访问largeObject可得到正确的值。
**结论**

如果返回的inner函数中有使用eval函数，则不LexicalEnvironment中的任何变量进行解除绑定的操作，保留所有变量的绑定，以避免产生不可预期的结果。

**间接调用eval**
**使用代码**
[object Object]  [object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object]
[object Object][object Object]  [object Object][object Object]
[object Object][object Object][object Object][object Object]
[object Object][object Object]
[object Object][object Object]
[object Object]
[object Object]  [object Object]
[object Object]

|  |
|  |

**测试结果**
~JScript.dll – 不回收，内存无下降趋势。
~Chakra – 回收，内存会恢复到outer函数执行前的状态。
~Carakan – 不回收，内存无下降趋势。
~V8 – 回收，访问largeObject抛出ReferenceError。
~SpiderMonkey – 回收，访问largeObject得到undefined。
**结论**

由于ECMAScript规定间接调用eval时，代码将在全局作用域下执行，是无法访问到largeObject变量的。因此对于间接调用eval的情况，各javascript引擎将按标准的方式进行处理，无视该间接调用eval的存在。

同样的，对于new Function(‘return largeObject;’)这种情形，由于标准规定new Function创建的函数的[[Scope]]是全局的LexicalEnvironment，因此也无法访问到largeObject，所有引擎都参照间接调用eval的方式，选择无视Function构造函数的调用。

**多个嵌套函数**
**使用代码**
[object Object]  [object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object][object Object]
[object Object][object Object]
[object Object][object Object]
[object Object]
[object Object][object Object]  [object Object][object Object]
[object Object][object Object]
[object Object][object Object]
[object Object]
[object Object]  [object Object]
[object Object]

|  |
|  |

**测试结果**
~JScript.dll – 不回收，内存无下降趋势。
~Chakra – 不回收，内存无下降趋势。
~Carakan – 不回收，内存无下降趋势。
~V8 – 不回收，访问largeObject可得到正确的值。
~SpiderMonkey – 不回收，访问largeObject可得到正确的值。
**结论**

不仅仅是被返回的inner函数，如果在outer函数中定义的嵌套的help函数中使用了largeObject变量（或直接调用eval），也同样会造成largeObject变量无法回收。因此javascript引擎扫描的不仅仅是inner函数的源码，同样扫描了其他所有嵌套函数的源码，以判断是否可以解除某个特定变量的绑定。

**使用with表达式**
**使用代码**
[object Object]  [object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object][object Object]  [object Object][object Object]
[object Object][object Object]
[object Object][object Object]
[object Object][object Object]
[object Object]
[object Object]  [object Object]
[object Object]

|  |
|  |

**测试结果**
~JScript.dll – 不回收，内存无下降趋势。
~Chakra – 回收largeObject，但不回收scope.o，内存恢复至outer函数被调用前并增加100MB左右（无法得知scope是否被回收）。
~Carakan – 不回收，内存无下降趋势。
~V8 – 不回收，访问largeObject和scope以及o均可得到正确的值。
~SpiderMonkey – 回收largeObject和scope，访问该2个变量均得到undefined，不回收o，可得到正确的值。
**结论**

当有with表达式时，V8将会放弃所有变量的回收，保留LexicalEnvironment中所有变量的绑定。而SpiderMonkey则会保留由with表达式生成的新的LexicalEnvironment中的所有变量的绑定，而对于outer函数生成的LexicalEnvironment，按标准的方式进行处理，尽可能解除其中的变量绑定。

**使用catch表达式**
**使用代码**
[object Object]  [object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object][object Object]
[object Object][object Object]  [object Object]
[object Object][object Object]  [object Object][object Object]
[object Object][object Object]
[object Object][object Object]
[object Object][object Object]
[object Object]
[object Object]  [object Object]
[object Object]

|  |
|  |

**测试结果**
~JScript.dll – 不回收，内存无下降趋势。
~Chakra – 回收largeObject和ex，内存会恢复到outer函数被调用前的状态。
~Carakan – 不回收，内存无下降趋势。
~V8 – 仅回收largeObject，访问largeObject抛出ReferenceError，但仍可访问到ex。
~SpiderMonkey – 仅回收largeObject，访问largeObject得到undefined，但仍可访问到ex。
**结论**

catch表达式虽然会增加一个LexicalEnvironment，但对闭包内变量的绑定解除算法几乎没有影响，这源于catch生成的LexicalEnvironment仅仅是追加了被catch的Error对象一个绑定，是可控的（相对的with则不可控），因此对变量回收的影响也可以控制和优化。但对于新生成并添加了Error对象的LexicalEnvironment，V8和SpiderMonkey均不会进一步优化回收，而Chakra则会对该LexicalEnvironment进行处理，如果其中的Error对象可以回收，则会解除其绑定。

**嵌套函数中声明的同名变量**
**使用代码**
[object Object]  [object Object]
[object Object][object Object]  [object Object][object Object][object Object]
[object Object]

[object Object][object Object]  [object Object][object Object][object Object][object Object]

[object Object][object Object]
[object Object][object Object]
[object Object]
[object Object]  [object Object]
[object Object]

|  |
|  |

**测试结果**
~JScript.dll – 不回收，内存无下降趋势。
~Chakra – 回收，内存会恢复到outer函数被调用前的状态。
~Carakan – 不回收，内存无下降趋势。
~V8 – 回收，内存会恢复到outer函数被调用前的状态。
~SpiderMonkey – 回收，内存会恢复到outer函数被调用前的状态。
**结论**

嵌套函数中有与外层函数同名的变量或参数时，不会影响到外层函数中该变量的回收优化。即javascript引擎会排除FormalParameterList和所有VariableDeclaration表达式中的Identifier，再扫描所有Identifier来分析变量的可回收性。

**总体结论**
首先一个较为明确的结论是，以下内容会影响到闭包内变量的回收：
~嵌套的函数中是否有使用该变量。
~嵌套的函数中是否有直接调用eval。
~是否使用了with表达式。

Chakra、V8和SpiderMonkey将受以上因素的影响，表现出不尽相同又较为相似的回收策略，而JScript.dll和Carakan则完全没有这方面的优化，会完整保留整个LexicalEnvironment中的所有变量绑定，造成一定的内存消耗。

由于对闭包内变量有回收优化策略的Chakra、V8和SpiderMonkey引擎的行为较为相似，因此可以总结如下，当返回一个函数fn时：

1.如果fn的[[Scope]]是ObjectEnvironment（with表达式生成ObjectEnvironment，函数和catch表达式生成DeclarativeEnvironment），则：

A.如果是V8引擎，则退出全过程。
B.如果是SpiderMonkey，则处理该ObjectEnvironment的外层LexicalEnvironment。
2.获取当前LexicalEnvironment下的所有类型为Function的对象，对于每一个Function对象，分析其FunctionBody：
A.如果FunctionBody中含有直接调用eval，则退出全过程。
B.否则得到所有的Identifier。
C.对于每一个Identifier，设其为name，根据查找变量引用的规则，从LexicalEnvironment中找出名称为name的绑定binding。
D.对binding添加notSwap属性，其值为true。
3.检查当前LexicalEnvironment中的每一个变量绑定，如果该绑定有notSwap属性且值为true，则：
A.如果是V8引擎，删除该绑定。
B.如果是SpiderMonkey，将该绑定的值设为undefined，将删除notSwap属性。
**对于Chakra引擎，暂无法得知是按V8的模式还是按SpiderMonkey的模式进行。**

从以上测试及结论来看，V8确实是一个优秀的javascript引擎，在这一方面的优化相当到位。而SpiderMonkey则采取一种更为友好的方式，不直接删除变量的绑定，而是将值赋为undefined，也许是SpiderMonkey团队考虑到有一些极端特殊的情况，依旧有可能导致使用到该变量，因此保证至少不会抛出ReferenceError打断代码的执行。而IE9的Chakra相比IE8的JScript.dll进步非常大，细节上的处理也很优秀。Opera的Carakan在这一方面则相对落后，完全没有对闭包内的变量回收进行优化，选择了最为稳妥但略显浪费的方式。

此外，所有带有优化策略的浏览器，都在内在开销和速度之间选择了一个平衡点，这也正是为什么“多个嵌套函数”这一测试用例中，虽然inner没有再使用largeObject对象，甚至在inner中的断点处，连help函数对象也已经解除绑定，却没有解除largeObject的绑定。基于这种现象，可以推测各引擎均只选择检查一层的关联性，即不去处理inner -> help -> largeObject这样深度的引用关系，只找inner -> largeObject和help -> largeObject并做一个合集来处理，以提高效率。也许这种方式依旧存在内存开销的浪费，但同时CPU资源也是非常贵重的，如何掌握这之间的平衡，便是javascript引擎的选择。

此外，根据部分开发者的测试，Chakra甚至有资格被称为现有最快速的javascript引擎，微软也一直在努力，而开发者更不应该一味地谩骂和嘲笑IE。

我们可以嘲笑IE6的落后，可以看不到低版本的IE曾经为互联网的发展做过的贡献，可以在这些历史产品已经没落的今天无情地给予打击，却最最不应该将整个IE系列一视同仁，挂上“垃圾”的名号。客观地去看待，去评价，正是一个技术人员应该具备的最基本的准则和素养。

### 如果您觉得此文有帮助，可以打赏点钱给我支付宝1669866773@qq.com ，或扫描二维码

![o_zhihubao.png](../_resources/00e07d3efbf06211cdc2915bdbcfeb27.png)![o_weixin2.png](../_resources/3681984fb92e20cb3fa7ca119c3be8e0.png)

机器瞎学/数据掩埋/模式混淆/人工智障/深度遗忘/神经掉线/计算机幻觉/专注单身二十五年

标签: [javascript](https://www.cnblogs.com/rubylouvre/tag/javascript/)

 [好文要顶](js闭包测试%20-%20司徒正美%20-%20博客园.md#)  [关注我](js闭包测试%20-%20司徒正美%20-%20博客园.md#)  [收藏该文](js闭包测试%20-%20司徒正美%20-%20博客园.md#)  [![icon_weibo_24.png](js闭包测试%20-%20司徒正美%20-%20博客园.md#)  [![wechat.png](js闭包测试%20-%20司徒正美%20-%20博客园.md#)

 [![u65123.jpg](../_resources/053a2c2da8867aa5a4609708348a6fd2.jpg)](https://home.cnblogs.com/u/rubylouvre/)

 [司徒正美](https://home.cnblogs.com/u/rubylouvre/)
 [关注 - 77](https://home.cnblogs.com/u/rubylouvre/followees/)
 [粉丝 - 8901](https://home.cnblogs.com/u/rubylouvre/followers/)

推荐博客

 [+加关注](js闭包测试%20-%20司徒正美%20-%20博客园.md#)

 6

 0

 [«](https://www.cnblogs.com/rubylouvre/p/3336184.html) 上一篇： [利用状态模式处理多个模态弹出层的显示隐藏](https://www.cnblogs.com/rubylouvre/p/3336184.html)

 [»](https://www.cnblogs.com/rubylouvre/p/3348250.html) 下一篇： [ScrollFix.js：一个 iOS5 溢出滚动的（有限）修复方案](https://www.cnblogs.com/rubylouvre/p/3348250.html)

posted on 2013-10-01 08:15 [司徒正美](https://www.cnblogs.com/rubylouvre/)  阅读(10847)  评论(3) [编辑](https://i.cnblogs.com/EditPosts.aspx?postid=3345294) [收藏](js闭包测试%20-%20司徒正美%20-%20博客园.md#)

### 评论

#### [#1楼](https://www.cnblogs.com/rubylouvre/p/3345294.html#2787288)2013-10-07 11:07 [web 的世界](https://www.cnblogs.com/jamesldj/)

好文
请教如何构造一个100MB 大对象?

   [支持(0)](js闭包测试%20-%20司徒正美%20-%20博客园.md#)  [反对(0)](js闭包测试%20-%20司徒正美%20-%20博客园.md#)

#### [#2楼](https://www.cnblogs.com/rubylouvre/p/3345294.html#2788586)[楼主]2013-10-09 07:52 [司徒正美](https://www.cnblogs.com/rubylouvre/)

自己为一个对象添加许多健值对!每个键值为一个很长的字符串

   [支持(0)](js闭包测试%20-%20司徒正美%20-%20博客园.md#)  [反对(0)](js闭包测试%20-%20司徒正美%20-%20博客园.md#)

#### [#3楼](https://www.cnblogs.com/rubylouvre/p/3345294.html#2790867) 2013-10-11 17:38 [菜鸟要飞](https://www.cnblogs.com/cherryGuo/)

顶这种文章，真好！最近发现chrome的heap snapshot真的不错~

   [支持(0)](js闭包测试%20-%20司徒正美%20-%20博客园.md#)  [反对(0)](js闭包测试%20-%20司徒正美%20-%20博客园.md#)

[刷新评论](js闭包测试%20-%20司徒正美%20-%20博客园.md#)[刷新页面](https://www.cnblogs.com/rubylouvre/p/3345294.html#)[返回顶部](https://www.cnblogs.com/rubylouvre/p/3345294.html#top)

登录后才能发表评论，立即 [登录](js闭包测试%20-%20司徒正美%20-%20博客园.md#) 或 [注册](js闭包测试%20-%20司徒正美%20-%20博客园.md#)， [访问](https://www.cnblogs.com/) 网站首页。

- [首页](https://www.cnblogs.com/)

- [新闻](https://news.cnblogs.com/)

- [博问](https://q.cnblogs.com/)

- [专区](https://brands.cnblogs.com/)

- [闪存](https://ing.cnblogs.com/)

- [班级](https://edu.cnblogs.com/)

[【推荐】超50万行C++/C#: 大型组态工控、电力仿真CAD与GIS源码库](http://www.softbam.com/index.htm)
[【推荐】未知数的距离，毫秒间的传递，声网与你实时互动](https://brands.cnblogs.com/agora)

[【推荐】电子签名认准大家签，上海CA权威认证](https://www.sheca.com/assets/wwx/page3.html?site=bokeyuan)

**相关博文：**

· [理解Javascript_15_作用域分配与变量访问规则,再送个闭包](https://www.cnblogs.com/fool/archive/2010/10/19/1855265.html)

· [理解闭包 js回收机制](https://www.cnblogs.com/wangyingblog/p/5569745.html)
· [js作用域与执行环境（前端基础系列）](https://www.cnblogs.com/ukerxi/p/8027236.html)
· [JS中的闭包（closure）](https://www.cnblogs.com/jingwhale/p/4574792.html)
· [JavaScript基础---作用域，匿名函数和闭包](https://www.cnblogs.com/ttcc/p/3763437.html)
» [更多推荐...](https://recomm.cnblogs.com/blogpost/3345294)

 **最新 IT 新闻**:
· [中消协通报高德地图：导航错误致青城山景区道路拥堵](https://news.cnblogs.com/n/675065/)
· [美团大学认证首批外卖运营师 未来一年将认证10万数字化人才](https://news.cnblogs.com/n/675059/)
· [《个人信息保护法》来了 广告屏内置摄像头采集影像有合规风险吗？](https://news.cnblogs.com/n/675050/)
· [点得亮QQ靓号 点不亮QQ的辉煌](https://news.cnblogs.com/n/675049/)
· [一加8T评测：屏幕依旧出色的旗舰机 升级背后是市场的博弈](https://news.cnblogs.com/n/675048/)
» [更多新闻...](https://news.cnblogs.com/)

Powered by:
[博客园](https://www.cnblogs.com/)
Copyright © 2020 司徒正美
Powered by .NET 5.0.0-rc.2.20475.5 on Kubernetes