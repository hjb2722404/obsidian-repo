漫谈递归：从斐波那契开始了解尾递归 -- 简明现代魔法

[首页](http://www.nowamagic.net/librarys/veda/)![](../_resources/5314c05b83b861dbb1140f2277562370.png)[计算机算法](http://www.nowamagic.net/librarys/veda/cate/Algorithm)![](../_resources/5314c05b83b861dbb1140f2277562370.png) [漫谈递归：从斐波那契开始了解尾递归](http://www.nowamagic.net/librarys/veda/detail/2325)

# [漫谈递归：从斐波那契开始了解尾递归](http://www.nowamagic.net/librarys/veda/detail/2325)

对尾递归的大概了解
在 2012年10月12日 那天写的     已经有 18777 次阅读了
感谢 [参考或原文](http://www.nowamagic.net/librarys/veda/detail/2325)

服务器君一共花费了254.001 ms进行了3次数据库查询，努力地为您提供了这个页面。

试试阅读模式？希望听取您的建议

尾递归（tail recursive），看名字就知道是某种形式的递归。简单的说递归就是函数自己调用自己。那尾递归和递归之间的差别就只能体现在参数上了。
尾递归wiki解释如下：

> 尾部递归是一种编程技巧。递归函数是指一些会在函数内调用自己的函数，如果在递归函数中，递归调用返回的结果总被直接返回，则称为尾部递归。尾部递归的函数有助将算法转化成函数编程语言，而且从编译器角度来说，亦容易优化成为普通循环。这是因为从电脑的基本面来说，所有的循环都是利用重复移跳到代码的开头来实现的。如果有尾部归递，就只需要叠套一个堆栈，因为电脑只需要将函数的参数改变再重新调用一次。利用尾部递归最主要的目的是要优化，例如在Scheme语言中，明确规定必须针对尾部递归作优化。可见尾部递归的作用，是非常依赖于具体实现的。

我们还是从简单的斐波那契开始了解[尾递归](http://www.nowamagic.net/librarys/veda/tag/%E5%B0%BE%E9%80%92%E5%BD%92)吧。

用普通的递归计算Fibonacci数列：
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]

[object Object]
[object Object]  [object Object][object Object]  [object Object]
[object Object]

[object Object]
[object Object]  [object Object][object Object][object Object]
[object Object]
[object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object]

[object Object]
[object Object][object Object][object Object][object Object][object Object]
[object Object]
[object Object][object Object][object Object][object Object][object Object]
[object Object]

[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object][object Object][object Object][object Object]
[object Object]

[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object]
[object Object]

[object Object]
[object Object]
[object Object]
[object Object]  [object Object][object Object]  [object Object]
[object Object]
[object Object]
[object Object]
[object Object][object Object][object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object]
程序员运行结果如下：
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]

[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object][object Object][object Object]
在i5的CPU下也要花费 3.502 秒的时间。

下面我们看看如何用尾递归实现[斐波那契](http://www.nowamagic.net/librarys/veda/tag/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91)数。

[object Object]
[object Object]
[object Object]
[object Object]
[object Object]

[object Object]
[object Object]  [object Object][object Object]  [object Object]
[object Object]

[object Object]
[object Object]  [object Object][object Object][object Object]
[object Object]
[object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object]

[object Object]
[object Object][object Object][object Object][object Object][object Object]
[object Object]
[object Object][object Object][object Object][object Object][object Object]
[object Object]

[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object][object Object][object Object][object Object]
[object Object]

[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object]
[object Object]

[object Object]

[object Object]  [object Object][object Object]  [object Object][object Object]  [object Object][object Object]  [object Object]

[object Object]
[object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object]
程序员运行结果如下：
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object][object Object][object Object]
快了一倍有多。当然这是不完全统计，有兴趣的话可以自行计算大规模的值，这里只是介绍尾递归而已。
我们可以打印一下程序的执行过程，函数加入下面的打印语句：
[object Object]

[object Object]  [object Object][object Object]  [object Object][object Object]  [object Object][object Object]  [object Object]

[object Object]
[object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object][object Object][object Object][object Object][object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object][object Object]
[object Object]
[object Object]
程序运行结果：
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object]
[object Object][object Object]  [object Object]
[object Object]
[object Object][object Object][object Object]

从上面的调试就可以很清晰地看出尾递归的计算过程了。acc1就是第n个数，而acc2就是第n与第n+1个数的和，这就是我们前面讲到的“迭代”的精髓，计算结果参与到下一次的计算，从而减少很多重复计算量。

fibonacci(n-1,acc2,acc1+acc2)真是神来之笔，原本朴素的递归产生的栈的层次像二叉树一样，以指数级增长，但是现在栈的层次却像是数组，变成线性增长了，实在是奇妙，总结起来也很简单，原本栈是先扩展开，然后边收拢边计算结果，现在却变成在调用自身的同时通过参数来计算。

#### 小结

尾递归的本质是：将单次计算的结果缓存起来，传递给下次调用，相当于自动累积。
在Java等命令式语言中，尾递归使用非常少见，因为我们可以直接用循环解决。而在函数式语言中，尾递归却是一种神器，要实现循环就靠它了。

很多人可能会有疑问，为什么尾递归也是递归，却不会造成栈溢出呢？因为编译器通常都会对尾递归进行优化。编译器会发现根本没有必要存储栈信息了，因而会在函数尾直接清空相关的栈。

#### 延伸阅读

此文章所在专题列表如下：
1. [漫谈递归：递归的思想](http://www.nowamagic.net/librarys/veda/detail/2314)
2. [漫谈递归：递归需要满足的两个条件](http://www.nowamagic.net/librarys/veda/detail/2315)
3. [漫谈递归：字符串回文现象的递归判断](http://www.nowamagic.net/librarys/veda/detail/2316)
4. [漫谈递归：二分查找算法的递归实现](http://www.nowamagic.net/librarys/veda/detail/2317)
5. [漫谈递归：递归的效率问题](http://www.nowamagic.net/librarys/veda/detail/2321)
6. [漫谈递归：递归与循环](http://www.nowamagic.net/librarys/veda/detail/2322)
7. [漫谈递归：循环与迭代是一回事吗？](http://www.nowamagic.net/librarys/veda/detail/2324)
8. [递归计算过程与迭代计算过程](http://www.nowamagic.net/librarys/veda/detail/2280)
9. [漫谈递归：从斐波那契开始了解尾递归](http://www.nowamagic.net/librarys/veda/detail/2325)
10. [漫谈递归：尾递归与CPS](http://www.nowamagic.net/librarys/veda/detail/2331)

11. [漫谈递归：补充一些Continuation的知识](http://www.nowamagic.net/librarys/veda/detail/2332)

12. [漫谈递归：PHP里的尾递归及其优化](http://www.nowamagic.net/librarys/veda/detail/2334)
13. [漫谈递归：从汇编看尾递归的优化](http://www.nowamagic.net/librarys/veda/detail/2336)
[我喜欢]()
[我的收藏夹](http://www.nowamagic.net/librarys/topics/favorites/)

*...*![transparent.gif](../_resources/046c7604a84c0768ef44c7afc2dff647.gif)

[![transparent.gif](../_resources/046c7604a84c0768ef44c7afc2dff647.gif)](http://service.weibo.com/staticjs/weiboshare.html?url=http%3A%2F%2Fwww.nowamagic.net%2Flibrarys%2Fveda%2Fdetail%2F2325&type=2&count=1&appkey=&title=&pic=&ralateUid=2809746632&language=zh_cn&dpc=1#)

 不打个分吗？

- [20](http://www.nowamagic.net/librarys/veda/detail/2325#)

- [40](http://www.nowamagic.net/librarys/veda/detail/2325#)

- [60](http://www.nowamagic.net/librarys/veda/detail/2325#)

- [80](http://www.nowamagic.net/librarys/veda/detail/2325#)

- [100](http://www.nowamagic.net/librarys/veda/detail/2325#)

![](../_resources/f9ced49f0004971194ed035f3ffc554f.jpg)
转载随意，但请带上本文地址：
http://www.nowamagic.net/librarys/veda/detail/2325

**如果你认为这篇文章值得更多人阅读，欢迎使用下面的分享功能。**

分享到：[新浪微博](http://www.nowamagic.net/librarys/veda/detail/2325#)[腾讯微博](http://www.nowamagic.net/librarys/veda/detail/2325#)[QQ空间](http://www.nowamagic.net/librarys/veda/detail/2325#)[人人网](http://www.nowamagic.net/librarys/veda/detail/2325#)[豆瓣网](http://www.nowamagic.net/librarys/veda/detail/2325#)[一键分享](http://www.nowamagic.net/librarys/veda/detail/2325#)[2](http://www.nowamagic.net/librarys/veda/detail/2325#)

小提示：您可以按快捷键 Ctrl + D，或点此 [加入收藏](漫谈递归：从斐波那契开始了解尾递归%20--%20简明现代魔法.md#)。