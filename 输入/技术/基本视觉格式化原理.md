# CSS基本视觉格式化原理

## 基本框

* 每个元素都会生成一个或多个矩形框，称为元素框
* 元素框中心有一个内容区
* 内容区周围有可选的内边距、边框和外边距
* 内容的背景会应用到内边距，外边距通常是透明的
* 内边距不能是负值，但外边距可以是负值
* 如果边框没有设置颜色，将取元素内容的前景色
* 边框如果有缝隙（如虚线），将透到下方的内容背景上。

###  包含块

* 每个元素都【相对于】其包含块摆放，包含块就是一个元素的“布局上下文”
* 对于【正常文本流中】的一个元素，其包含块由【最近的块级祖先框】、【表单元格】或【行内块祖先框】的【内容边界】构成

### 概念复习
* 正常流：即从左向右，从上向下显示。 大多数元素都在正常流中，除非它是浮动或定位元素
* 非替换元素： 元素【内容】包含在文档中，就是非替换元素
* 替换元素：用作为其他内容占位符的一个元素
* 块级元素：会在框的前后生成换行，所以正常流中的块级元素会垂直摆放。
* 行内元素：不会在元素前后生成行分隔符，是块级元素的后代。
* 根元素：位于【文档树】顶端的元素，在HTML文档中就是`html`元素

## 块级元素

### 水平格式化

* 在正常流中，块级元素框的水平部分总和等于父元素的`width`

#### 水平格式化七属性

* `margin-left`
* `border-left`
* `padding-left`
* `width`
* `padding-right`
* `border-right`
* `margin-right`

其中，只有3个元素可设置`auto`值：`width/margin-left/margin-right`

* 设置为`auto`值的属性会根据七属性中其它属性的值的和来确定自己的值，从而使得七属性相加为父级块元素的宽度。
* 如果这三个属性都设置为非`auto`值，这叫【格式化属性过分受限】,此时会强制将`margin-right`设置为`auto`。
* 如果三个属性中两个都设置为`auto`
	* 如果是两个外边距设置为`auto`，则他们将等宽，他们的宽度等于父级块元素的宽度减去其余5个属性宽度的和再平分。
	* 如果是`width`与其中一个外边距设置为`auto`，则该外边距将被设置为`0`。
* 如果三个属性都设置为`auto`，则两个外边距都会被设置为`0`

#### 负外边距

* 元素外边距可以设置为负值
* 负外边距可能导致元素宽度比父元素宽度要宽，如果要减小元素宽度，可以尝试增大其它边框或边距的值。

#### 百分数

* 最好不要混用百分比与数值来设置水平七属性的值

#### 替换元素

* 以上非替换块元素的水平格式化规则同样适用于替换块元素，只有一个例外：如果`width`为`auto`，元素的宽度则是内容的固有宽度


### 垂直格式化

* 一个元素的默认高度由其内容决定
* 高度还会受内容宽度影响，段落越窄，就会越高
* 如果指定高度大于内容高度，则就像是有额外的内边距
* 如果指定高度小于内容高度，则根据`overflow`属性的值来决定显示效果

#### 垂直格式化七属性

* `margin-top`
* `border-top`
* `padding-top`
* `height`
* `padding-bottom`
* `border-bottom`
* `margin-bottom`

只有3个属性可设置`auto`，`height/margin-top/margin-bottom`

* 正常流中的一个块元素，如果它的`margin-top`或`margin-bottom`设置为`auto`，则它会自动计算为0

#### 百分数高度

* 如果包含块`height`为`auto`，则元素自身的百分比`height`将失效，元素将与父元素一样高。

#### auto高度

* 如果块级正常流元素设置为`height:auto`，则其高度将恰好足以包含其内链内容的行盒。
* 高度为`auto`时，会在段落上设置一个边框，并认为没有内边距，这样下边框刚好在最后一行的下面，上边框刚好在文本第一行的上面。
* 如果只有块级子元素，其默认高度将是从最高块级子元素的外边框边界到最低块级子元素外边框边界之间的距离。（即此时元素高度不会包含子元素的上下外边距）此时子元素如果有外边距，则子元素高度则会高于父元素高度。不过，如果元素由上下内边距或上下边框，子元素的上下外边距则会包含在元素高度中。

#### 合并垂直外边距

* 上下相邻的两个外边距，会被合并为较大外边距的值

#### 负外边距

* 如果垂直外边距都设置为负值，浏览器会取两个外边距绝对值比较大的那个负外边距
* 如果一个正外边距与一个负外边距合并，会从正外边距减去这个负外边距的绝对值

### 列表项

* `list-style-position` 的值可以设置列表项符号是在列表框内还是列表框外。

## 行内元素

### 行布局

* 块级元素只是生成框，通常不允许其他内容与这些框并存。
* 对于行内元素来说，边框画在各行之外的下一个像素上。
* 行内元素的文本两端对齐时，`word-spacing`的值可能被覆盖

### 基本术语和概念

* 匿名文本： 所有未包含在行内元素中的字符串（包含空格）
* `em` 框： 即字符框。`font-size`的值确定了各个`em`框的高度。
* 内容区： 
	* 在非替换元素中，可能是下面两种其中一种
		* 元素中各字符的`em`框串在一起构成的框
		* 由元素中字符字形描述的框
	* 在替换元素中，就是元素固有高度再加上可能由的外边距、边框或内边距
* 行间距：是`font-size`值和`line-height`值之差，这个差分为两半，分别应用于内容区的顶部和底部。【行间距只应用于非替换元素】
* 行内框：通过向内容区增加行间距来描述
	* 对于非替换元素，行内框高度刚好等于`line-height`的值
	* 对于替换元素，行内框的高度恰好等于内容区的高度（因为行间距不应用到替换元素）
* 行框：可以包含行中所有行内框最高点和最低点的最小框。
* 基于以上术语，有以下规则
	* 内容区类似于一个块级元素的内容框
	* 行内元素的背景应用于内容区及所有【内边距】
	* 行内元素的边框要包围内容区及其所有【内边距和边框】
	* 非替换元素的内边距、边框和外边距对行内元素或其生成的框没有垂直效果，也就是说，它们不会影响【行内框】的高度，也不会影响包含该元素的【行框】的高度。
	* 替换元素的外边距和边框会影响元素【行内框】和【行框】的高度。
	* 【行内框】在行中根据其`vertical-align`属性值垂直对齐
* 构造行框高度的步骤
	1. 确定行中各元素【行内框】的高度：
		1. 得到各行内【非替换元素】及【不属于后代行内元素】的所有文本的`font-size`值和`line-height`值，再将`line-height`值减去`font-size`值，就得到了【框的行间距】，这个间距除以2，将其一半分别应用到`em`框的顶部和底部
		2. 得到各【替换元素】的`height、margin-top、margin-bottom、padding-top、padding-bottom、border-top-width`和`border-bottom-width`值，把它们（垂直七属性）加在一起。
	2. 对于各【内容区】，确定它在【整行基线】的上方和下方分别超出多少。（对于替换元素，要将其底边放在整行的基线上）
	3. 对于指定了`vertical-align`值的元素，确定其垂直偏移量。以此来确定该元素的【行内框】要向上或向下移动多元，并改变元素在基线上方或下方超出的距离
	4. 最后计算【行框】高度。只需要将基线与最高行内框顶端之间的距离加上基线与最低行内框底端之间的距离。

### 行内格式化

* 行的高度由其组成元素和其他内容（如文本）的高度确定。
* `line-height`只会影响行内元素和其他内容的高度，如果为块级元素设置该属性，也只会影响块级元素中的行内元素及内容，这些内容的最小高度将是块级元素的行高。
* 从某种程度上讲，块级元素中包含的各文本行本身都是行内元素，而不论是否真正用行内元素标记包围起来

### 行内非替换元素

#### 建立框

* 对于行内非替换元素或匿名文本的某一部分，内容区的高度就是`font-size` 的值，因为构成内容区的所有`em`框的高度都是`font-size`值
* 行内框的高度则是内容区高度加上其上下半间距（=（行高-字体大小）/ 2）的高度，也就等于内容区加上行间距（=行高-字体大小）的高度
* 行内的文本底部都是按基线对齐的
* 如果字体大小大于行高，可能造成【内容区】高度比【行内框】高度要大，从而内容会超出【行内框】而与上一行的行框底部重叠。

#### 垂直对齐

* 行内元素的`vertical-align`可以设置为数值，这会同时提升（或下移）该元素内容区和行内框，行框位置也会随着变动（随着行框增高，整行基线会下移）。
* 行内元素的`line-height`也会影响行框的放置
* `vertical-align`取值说明：
	* `top`: 元素行内框的顶端与所在行框的顶端对齐
	* `bottom`：元素行内框的底端与所在行框的底端对齐
	* `text-top`：元素行内框的顶端与所在元素内容区的顶端对齐
	* `text-bottom`：元素行内框的底端与所在元素内容区的底端对齐
	* `middle`： 元素行内框的垂直中点与父元素基线上`0.5ex`处的一点对齐
	* `super`：将元素的内容区和行内框上移
	* `sub`：将元素的内容区和行内框下移
	* 百分比： 将元素上移或下移一定距离，该距离由【相对于元素`line-height`值】指定的一个百分比数确定。
	* 数值：将元素上移或下移指定数值距离。

### 管理`line-height`

* `line-height`  相对于元素本身的`font-size`设置，而不是相对于父元素设置。
* 在同一行中，如果某个元素字体大小相对于行中其它内容有不同，为其设置`line-height` 可以避免它与其它行的内容发生重叠
* 为父元素设置`line-height:1`(行高是字体大小的1倍，即相等)，行内元素将继承这个行高，因此，行内框的高度与内容区的高度将保持一致。
* 行框高度取决于行内各元素如何对齐-> 各元素如何对齐依赖于基线落在各元素的哪个位置，-> 基线位置在各个字体中不同，内置在字体文件中，除非直接编辑字体文件，否则无法修改。

#### 缩放行高

* 当使用原始数字值定义`line-height`时，这个数值是一个缩放因子，此时它是继承值而非计算值。

#### 增加框属性

* 行内元素的边框边界由`font-size`而非`line-height`控制。
* 可以为行内元素指定内边距来把边框从文本本身拉开；（这会影响行内框高度，但不会影响行框）
* 外边距不会作用到行内非替换元素的上下，但会作用于左右两端
* 行框会按照文档职工的顺序绘制，这导致行框如果发生重叠，后绘制的行框会覆盖先绘制的行框，背景也一样，如过多行中的中间某行和上下行都重叠，并且它带有背景，则它上面的行会被其背景覆盖，而其下面的行内容则会显示在其背景之上。

### 行内替换元素

* 行内替换元素形成的行内框将使用替换元素整体来定义，它可能增加行框高度，但不会改变任何元素的`line-height`.
* 行内替换元素之所以有`line-height`值，是用来进行垂直对齐的，比如`vertical-align`的百分比值是要根据`line-height`来计算的

#### 增加框属性

* 行内替换元素的内边距和边框会影响行框的高度。
* 负外边距是使行内替换元素挤入其他行的唯一办法。

#### 替换元素和基线

* 默认地，行内替换元素位于基线上。
* 如果向替换元素增加下内边距、外边距或边框，内容区会上移。
* 替换元素并没有自己的基线。（因为基线位置只定义在字体文件中）
* 当块级元素或行内元素只有一个图片作为子元素时，为了修正它没有基线造成的位置错误，可以将图片设置为块级元素，这样它们就不会生成行框。

## 改变元素显示 

### 改变角色

* 可以通过改变`display`值来改变元素的显示角色
* 但是改变的只是显示角色，而不是其本质，例如，让一个段落生成行内框并不会把这个段落真正变成一个行内元素。

### 行内块元素

* 行内块元素会作为替换元素放在行中，这意味着，行内块元素的底端默认地位于文本行的基线上，而且内部没有行分割符。
* 在行内块元素内部，会像块级元素一样设置内容的格式。
* 如果行内块元素的`width`未定义，或者显式声明为`auto`，元素框会收缩以适应内容。

### run-in元素

* `run-in` 是块/行内元素混合，可以使某些块级元素成为下一个元素的行内部分。
* `run-in`元素的下一个元素必须是块级元素框，否则它将成为一个块级框。
* 即使`run-in`框格式化为另一个元素中的行内框，它们仍从文档中的父元素继承属性，而不是说它们放在哪个元素中就从哪个元素继承属性。

### 计算值

* 如果元素时浮动元素或定位元素，`display`的计算值可以改变。
* 如果为一个根元素声明`display`值，计算值也可以改变
