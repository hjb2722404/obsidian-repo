# 富文本编辑器开发系列-基础概念



[TOC]



## 前言

富文本编辑器是前端开发中常见的功能，一般情况下，我们可以用成熟的开源富文本编辑器，比如比较老牌的 `ueditor, ckeditor` , 或者近几年兴起的 `draft.js` 等。

但是，总会有二般情况：

* 实际应用需求超出了这些开源编辑器提供的标准功能；
* 实际应用需求很少，使用这些开源编辑器会过于复杂和臃肿；

这个时候，我们就面临着两种选择：

1.  对这些开源编辑器进行二次开发，以适应应用需求；
2. 自己从头撸一款富文本编辑器，自己掌控一切；

这两种选择，都意味着我们要对富文本编辑器的底层技术有所了解，甚至如果要自己撸一款富文本编辑器的话，还要非常精通这些技术，所以从本文开始，就将用比较通俗易懂的方式（就是好多好多动态图和逻辑图），对开发富文本编辑器涉及到的基础技术进行讲解。以帮助朋友们飞升（升职加薪走一波）。

## 富文本编辑器的基本发展史

整体来说，富文本编辑器经历了三个阶段的发展。

### 1.0 时代  —— 原始时代，`contenteditable` 大法好

在那个前端工程师还叫做网页设计师（俗称切图仔）的刀耕火种的年代，各种BBS留言板的出现，产生了对前端更丰富的文本编辑的需求，传统的`textarea`已经远远不能胜任，所以出现了第一代的富文本编辑器。

那时候的编辑器存活到现在的已经没有了，但他们是开拓者，这些前辈开发者利用浏览器`DOM`提供的 `contenteditable` 属性和 `document.execCommand` 方法，开发出了第一代的轻量级的富文本编辑器。虽然其功能及其简单，也只是单纯利用了web浏览器提供的原生API，但是为后面2.0时代的富文本编辑器打下了基础。

![](https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210151335.jpeg)

### 2.0 时代 —— 现代化，视图与模型分离

进入2.0时代，由于浏览器`document.execCommand` 有着各种各样的问题，大神们决定自己实现`execCommand` 方法，自己掌控内容的变化与格式，由此产生了一大批优秀的更加现代化的富文本编辑器，如`ueditor`，`ckeditor` 早期版本等。

![](https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210151342.png)

后来，进入21世纪后，视图与模型分离的思想逐渐征服了前端的大神们，于是又出现了改进版的将视图与数据模型进行分离管理的现代化编辑器，如`draft.js` , `ckeditor` 后期版本等。

![image-20200827101736796](https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210151356.png)

### 3.0 时代 —— 后现代， 抛弃 `contenteditable`

由于急于`contenteditable`的编辑器，其输入完全是由用户掌控，而非由开发者掌控，所以就会出现无穷种不同的`dom`结构，造成各种不可控不可预知的行为后果，这对于追求可控严谨的前端工程师们来说简直是噩梦。所以出现了3.0时代的富文本编辑器。

开发者彻底摒弃了`contenteditable`属性，而是完全使用普通布局容器加`js`对DOM事件的监听实现，完全将富文本编辑器的输入到渲染的整个流程都在自己的掌控之中。比如 `google docs`, `office online`, `icloud pages`, `wps在线编辑`等。

![image-20200827102744432](https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210151820.png)

因为第三代编辑器实现起来动辄需要几十万到几百万行代码，需要一个非常庞大和专业的团队去开发和维护，也只有文本编辑的巨头能搞得起，所以，当前应用最广的依旧是第二代浏览器。

## 基础概念

### 编辑区

在一个完整应用界面中，富文本编辑器通常都是一个表单的一部分，而在编辑器中，编辑区是除去工具条（各种功能按钮所在区域）和状态栏（显示字数等额外信息）以外的，允许用户输入内容的区域。

但是编辑区并不是富文本编辑器独有的概念，事实上，只要是设置了`contenteditable` 属性的`DOM`元素包裹的内容区，都允许用户输入内容和对其中的内容进行修改，那这块内容区就是可编辑区，而富文本编辑器只是继承了这种特性和概念。

![image-20200827103932904](https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210151828.png)

### 选区

选区是指当一个编辑区获得焦点时，用户选择的文本范围或插入符号的当前位置。 现代浏览器通常一个编辑区都只有一个选区，只要火狐浏览器可以在一个编辑器内通过按住键盘`alt` 键产生多个选区。一个选区可以包含多个`DOM`元素，即它是可以跨节点的。

![image-20200827105347754](https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210151843.png)

### 拖蓝

拖蓝，表示一个包含节点与文本节点的一部分的文档片段。通常情况下，选区与拖蓝所包含的`DOM`元素部分是相同的，它们的不同在于其本质，选区偏重于强调范围和位置，而拖蓝强调的则是包含的`DOM`内容。从它的表现形式就可以知道它为什么为叫做拖蓝（拖动后产生的蓝色区域）。

>当然，拖蓝是中文意译法，其英文是`range`（范围）

![image-20200827105702294](https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210151857.png)

### 光标

光标是特殊的拖蓝，可以认为光标就是移动拖蓝的某个端点到另一个端点的位置，两个端点重合时所在的区域或位置。

![](https://gitee.com/hjb2722404/tuchuang/raw/master/img/20201210151924.gif)

## 基本API

### `contenteditable`

该属性用在`DOM`元素上，它用来表明元素是否可编辑，如：

```
<div contenteditable="true"></div>
```


上面的`HTML` 语句表明这个`div`包裹的区域是允许用户进行编辑的。

这个属性有三个可选值：

* `"true"` 表明该元素可编辑。
* `"false"` 表明该元素不可编辑。
* `"inherit"` 表明该元素继承了其父元素的可编辑状态

###  `document.execCommand()`

这是`HTML`文档对象的一个方法，该方法可以被用来操纵可编辑内容区域的元素。

### 语法

`bool = document.execCommand(name, isShowDefaultUI, argument);`

### 参数说明

* `name` ， 字符串，命令的名称，可用命令见下文表格
* `isShowDefaultUI`布尔值，是否展示用户界面，一般为 `false`， 并且`Mozilla` 没有实现
* `augument`  额外参数，某些命令需要传入额外的参数

具体可阅读 [document.execCommand 的API](./富文本编辑器开发系列——浏览器document.execCommond()API.md)

### `selection && range`

`seleection` 和 `range`  都是`Web API`的一部分，同时他们也是实现在开发富文本编辑器中最常用到的`API`.

对于它们的具体研究，请参阅：

* [富文本编辑器开发系列——selection](./富文本编辑器开发系列——selection.md) 

* [富文本编辑器开发系列——Range对象](./富文本编辑器开发系列——Range对象.md)

`DOM`

在实现富文本编辑器的过程中，需要大量的`DOM`操作，这就要求我们要对`DOM`的各种`API`非常熟悉，才能运用正确的`API` 准确实现预期的功能。

当然，`DOM API` 非常之多而且很庞杂，很多都是富文本编辑器开发中用不到的，基于此考虑，我单独介绍了开发富文本编辑器常用的`DOM API`， 请参阅：

[富文本编辑器开发系列——常用DOM API](富文本编辑器开发系列——常用DOM API.md)

